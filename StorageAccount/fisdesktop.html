<html>
<head>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<style>
    .table-responsive {
    	display:table-cell;
    	width:100%;
		}
	.alert-success-alt {border-color: #19B99A; background: #137792}
</style>
<script src="scripts/azure-storage.blob.min.js" charset="utf-8"></script>
<script type='text/javascript'>
	const account = {
		name: 'dcoldevsldweu',
		sas:  '?sv=2018-03-28&ss=b&srt=c&sp=rl&se=2019-08-20T21:22:58Z&st=2019-08-06T13:22:58Z&spr=https,http&sig=KEwOp%2B6Wjj1E8JmilUp%2Bu6MkWKNYI1lKQEyMtw6rcrY%3D',
		container: 'fis-downloads',
		filter: 'DC-ILR-1920-FIS',
		topXrecords: 5
	};
	
	function fileSize(size) {
	   var i = Math.floor(Math.log(size) / Math.log(1024));
	    return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' '+['B', 'kB', 'MB', 'GB', 'TB'][i];
	}

	function sortFunction(a,b){  
		var dateA = new Date(a.date).getTime();
		var dateB = new Date(b.date).getTime();
		return dateA > dateB ? 1 : -1;  
	}; 

	function listContent()
	{
		document.getElementById('Release').innerHTML = 'Loading...';

		const blobUri = 'https://' + account.name + '.blob.core.windows.net';
		const blobService = AzureStorage.Blob.createBlobServiceWithSas(blobUri, account.sas);
		
		blobService.listBlobsSegmented('fis-downloads', null, (error, results) => {
        if (error) {
				document.getElementById('Release').innerHTML = 'Error Getting Data.' + '<br>' + error;
				return;
			} else {
				var output = [];

				output.push('<tr>',
							'<th>Link</th>',
							'<th>Size</th>',
							'<th>LastModified</th>',
							'</tr>');
				if (results.entries.length < 1) {
					output.push('<tr><td>Empty results...</td></tr>');
				}
				else
				{
					results.entries.sort(function(a,b){
					  // Turn your strings into dates, and then subtract them
					  // to get a value that is either negative, positive, or zero.
					  return new Date(b.lastModified) - new Date(a.lastModified);
					});

					let sortToList = results.entries.slice(0, account.topXrecords);

					for (var i = 0, blob; blob = sortToList[i]; i++) {
						if (blob.name.toLowerCase().startsWith(account.filter.toLowerCase()))
						{
							output.push('<tr>',
										'<td><a href='+blobUri+"/"+account.container+"/"+blob.name+'>', blob.name, '</a></td>',
										'<td>', fileSize(blob.contentLength), ' </td>',
										'<td>', blob.lastModified, '</td>',
										'</tr>');
						}
					}
				}
				document.getElementById('Release').innerHTML = '<table class="table table-condensed table-bordered">' + output.join('') + '</table>';
			}
		});
	}	

</script>
</head>
<body onload="listContent()">
    <div class="container">
<div id="header" class="alert alert-success-alt" role="alert">
    <h3 class="Display-3">FIS Download</h3>
    </br>
<div ><h5>Please select the appropriate release from the following list and download:</h5></div>
</div>
<div id="Release" class="table-responsive">Loading</div>
<div >
</br>
    <h4 >Previous Releases:</h4>
</br>
<div id="OldRelease" class="table-responsive">
    <table class="table table-striped table-bordered">
         <thead>
           <tr>
                <th></th>
                <th></th>
            </tr>
            </thead>
        <tbody>
        <tr>
            <td>Funding Information System (FIS)</td>
             <td><a href="https://des.fasst.org.uk/Pages/fis.aspx" target="_blank" >Open in new Window</a></td>             
        </tr>
      
        </tbody>
    </table>
</div>
</div>

</body>
</html>
